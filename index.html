<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://agent-gkcp.onrender.com; media-src 'self' blob: mediastream: *; script-src 'self' 'unsafe-inline'; connect-src 'self' https://agent-gkcp.onrender.com mediastream: *;">
    <title>Assistant Vocal - Production</title>
    <!-- Reste du style inchangé -->
</head>
<body>
    <!-- Même contenu HTML -->
    <script>
        async function checkMicrophoneAccess() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const audioInputs = devices.filter(device => device.kind === 'audioinput');
                if (audioInputs.length === 0) {
                    throw new Error('Aucun microphone détecté');
                }
                console.log('Microphones disponibles:', audioInputs);
                return true;
            } catch (error) {
                console.error('Erreur lors de la vérification du microphone:', error);
                return false;
            }
        }

        async function startRecording() {
            try {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('L\'API MediaDevices n\'est pas supportée sur ce navigateur');
                }

                const hasMicrophone = await checkMicrophoneAccess();
                if (!hasMicrophone) {
                    throw new Error('Aucun microphone n\'est accessible');
                }

                console.log('Demande d\'accès au microphone...');
                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 16000,
                        channelCount: 1
                    }
                });

                // Reste du code startRecording inchangé
            } catch (error) {
                console.error('Erreur détaillée:', error);
                let errorMessage = 'Erreur d\'accès au microphone: ';
                
                // Gestion d'erreur améliorée
                switch(error.name) {
                    case 'NotAllowedError':
                        errorMessage += 'Permission refusée. Veuillez autoriser l\'accès au microphone dans les paramètres du navigateur.';
                        break;
                    case 'NotFoundError':
                        errorMessage += 'Aucun microphone détecté. Veuillez vérifier la connexion de votre microphone.';
                        break;
                    case 'NotReadableError':
                        errorMessage += 'Le microphone est peut-être utilisé par une autre application.';
                        break;
                    case 'SecurityError':
                        errorMessage += 'Problème de sécurité - vérifiez que le site est en HTTPS';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                updateStatus(errorMessage);
                document.getElementById('status').classList.add('error');
            }
        }

        // Reste du code JavaScript inchangé
    </script>
</body>
</html>